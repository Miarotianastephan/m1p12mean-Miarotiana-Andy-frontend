<div *ngIf="onLoadinggetReparation()" class="grid grid-cols-3 gap-2">
  <div
    *ngFor="let _ of [1, 2, 3, 4, 5, 6]"
    class="rounded border border-surface-200 dark:border-surface-700 p-6 bg-surface-0 dark:bg-surface-900"
  >
    <div class="flex mb-4">
      <p-skeleton shape="circle" size="2rem" styleClass="mr-2" />
      <div>
        <p-skeleton width="10rem" styleClass="mb-2" />
        <p-skeleton height=".5rem" />
      </div>
    </div>
    <p-skeleton width="100%" height="100px" />
    <div class="flex justify-between mt-4">
      <p-skeleton width="4rem" height="2rem" />
      <p-skeleton width="4rem" height="2rem" />
    </div>
  </div>
</div>
<div
  *ngIf="!onLoadinggetReparation() && !onErrorgetReparation()"
  class="grid grid-cols-3 gap-2"
>
  <p-panel [toggleable]="true" *ngFor="let repair of onusegetReparation()">
    <ng-template #header>
      <div class="flex items-center gap-2">
        <p-avatar
          image="https://primefaces.org/cdn/primevue/images/avatar/amyelsner.png"
          shape="circle"
        />
        <span class="font-bold text-sm">{{ repair.nameuser }}</span>
      </div>
    </ng-template>
    <ng-template #footer>
      <div class="flex flex-wrap items-center justify-between">
        <div *ngIf="repair.mechanics.length === 0">
          <span class="text-xs">Aucun mecaniciens assignier</span>
        </div>
        <div *ngFor="let item_mecano of repair.mechanics">
          <p-avatar icon="pi pi-user" class="mr-2" shape="circle" />
        </div>
        <p-button
          *ngIf="repair.mechanics.length === 0"
          icon="pi pi-users"
          label="Assigne mecano"
          size="small"
          outlined="variant"
          (click)="showDialog(repair)"
        />
        <p-button
          *ngIf="
            repair.status_creneaux === 'creneaux att' &&
            repair.mechanics.length > 0
          "
          icon="pi pi-calendar-clock"
          label="Creneaux"
          size="small"
          outlined="variant"
          (click)="ShowDialogCreneaux(repair)"
        />
        <p-button
          *ngIf="repair.status_creneaux === 'creneaux dispo'"
          icon="pi pi-calendar-clock"
          label="Creneaux dispo"
          size="small"
          outlined="variant"
        />
      </div>
    </ng-template>
    <div>
      <p class="m-0 text-xs">{{ repair.description_problem }}</p>
      <p class="text-xs mb-2">
        voiture : {{ repair.marquecar }} {{ repair.modelcar }} ({{
          repair.yearcar
        }})
      </p>
      <p-progressbar [value]="0" [style]="{ height: '15px' }" />
    </div>
  </p-panel>
</div>
<p-dialog
  header="Creneaux"
  [modal]="true"
  [(visible)]="visible_modal_creneaux"
  [style]="{ height: '30rem' }"
>
  <div class="grid grid-cols-2 gap-2 mb-1">
    <p-datepicker
      [(ngModel)]="date"
      class="w-full"
      placeholder="Date"
    /><p-datepicker
      inputId="calendar-timeonly"
      [(ngModel)]="time"
      [timeOnly]="true"
      placeholder="heure"
    />
  </div>
  <div class="flex justify-end">
    <p-button
      icon="pi pi-plus-circle"
      outlined="variant"
      (click)="showCreneaux()"
    />
  </div>
  <div>
    <span class="text-sm">Les creneaux choisis pour le reparation</span>
    <div class="flex flex-col space-y-1">
      <div
        *ngFor="let element of creneaux"
        class="text-sm border p-2 flex flex-col space-y-1 rounded-lg"
      >
        <span
          >Debut de reparation :
          {{ element.dateBegin | date : "dd-MM-yyyy HH:mm" }}</span
        >
        <span
          >Fin de reparation :
          {{ element.dateFin | date : "dd-MM-yyyy HH:mm" }}</span
        >
      </div>
    </div>
  </div>
  <div class="flex justify-end mt-1">
    <p-button
      icon="pi pi-question-circle"
      iconPos="right"
      label="Proposer"
      outlined="variant"
      (click)="OnuseCreateCreneaux()"
      [loading]="useCreateCreneaux.isPending()"
      [disabled]="creneaux.length === 0"
    />
  </div>
</p-dialog>
<p-dialog
  header="Mecanicien"
  [modal]="true"
  [(visible)]="visible"
  [style]="{ width: '50rem' }"
>
  <div *ngIf="onLoadinggetMecaniciens()">
    <p-skeleton styleClass="mb-2" />
    <p-skeleton width="10rem" styleClass="mb-2" />
    <p-skeleton width="5rem" styleClass="mb-2" />
  </div>
  <div
    *ngIf="!onLoadinggetMecaniciens() && !onErrorgetMecaniciens()"
    class="grid grid-cols-2 gap-2"
  >
    <div
      class="flex border p-3 rounded-lg transition-shadow duration-300 cursor-pointer"
      *ngFor="let item of onusegetMecaniciens()"
      (click)="assignMecano(item)"
      [ngClass]="{ 'shadow-md': isClicked.has(item) }"
    >
      <p-avatar label="S" class="mr-2" size="large" />
      <div class="flex flex-col space-y-1">
        <span class="text-sm font-bold">{{ item.fullName }}</span>
        <span class="text-xs">Comp√©tences : {{ skillsText(item) }} </span>
        <span class="text-xs">Contact : {{ item.phonenumber }}</span>
      </div>
    </div>
  </div>
  <div class="mt-5">
    <span class="text-xs">
      Nombre des mecaniciens selectionnes : {{ mecano_assign.length }}</span
    >
  </div>
  <div class="flex justify-end gap-2">
    <p-button label="Cancel" severity="secondary" (click)="visible = false" />
    <p-button
      label="Enregister"
      size="small"
      [loading]="useToAssingMecanoWork.isPending()"
      (click)="OnuseToAssingMecanoWork()"
      [disabled]="mecano_assign.length === 0"
    />
  </div>
</p-dialog>
